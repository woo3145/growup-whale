<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="utf-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1" />
      <title>고래키우기 - 회원가입</title>
      <style>
         @import url('https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css');
      </style>
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />
      <link
         href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
         rel="stylesheet"
         integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM"
         crossorigin="anonymous"
      />
   </head>

   <style></style>

   <body data-bs-theme="dark">
      <h3>회원가입 페이지</h3>
      <form>
         <div>
            <label for="nickname">닉네임 :</label>
            <input type="text" id="nickname" name="nickname" placeholder="닉네임" />
         </div>

         <div>
            <label for="email">이메일 :</label>
            <input type="text" id="email" name="email" placeholder="이메일" />
         </div>

         <div>
            <label for="email">패스워드 :</label>
            <input type="password" id="pw" name="pw" placeholder="패스워드"  />
         </div>
         <div>
            <label for="email">패스워드 재확인:</label>
            <input type="password" id="pw_check" name="pw_check" placeholder="패스워드 재확인" />
         </div>
         <button onclick="submitForm()" type="button">가입하기</button>
      </form>

      <script
         src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
         integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
         crossorigin="anonymous"
      ></script>
      <script>
        function submitForm() {
            var email = document.getElementById("email").value;
            var pw = document.getElementById("pw").value;
            var nickname = document.getElementById("nickname").value;
            var pw_check = document.getElementById("pw_check").value;
    
            // 입력값이 비어 있는지 확인
            if (!email || !pw || !nickname) {
                // 팝업 창으로 오류 메시지 표시
                alert("아이디 혹은 패스워드가 입력되지 않았습니다.");
                return;
            }
    
            // 서버로 보낼 데이터를 객체로 만듭니다.
            var data = {
                email: email,
                pw: pw,
                nickname: nickname,
                pw_check: pw_check
            };
    
            // 서버로 POST 요청을 보냅니다.
            fetch('http://127.0.0.1:5000/register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => {
                return response.json();
            })
            .then(data => {
              if (!data.success) {
                     alert(data.message)
                } else {
                  alert('회원가입이 성공적으로 완료되었습니다. 환영합니다~');

                  if(data.access_token){
                     document.cookie = 'access_token=' + data.access_token + '; Secure; HttpOnly';  // httponly 및 secure는 선택적인 보안 설정
                  } else {
                     alert('token 안들어옴')
                  }
                }
                // 서버에서의 응답을 처리합니다
                
                
    
                // 이후 원하는 작업 수행 (예: 페이지 리디렉션)
                
                
                
               
            })
            .catch((error) => {
                // 팝업 창으로 오류 메시지 표시
                alert(error.message);
                console.error('Error:', error);
            });
        }
    </script>
   </body>
</html>
